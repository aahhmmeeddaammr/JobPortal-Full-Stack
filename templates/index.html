{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign-In</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <link rel="stylesheet" href=" {% static 'CSS/MAINStyle.css' %}">
    <link rel="stylesheet" href="{% static 'CSS/style.css' %}">
</head>
<body> 
    <div class="sign-in-box ">
            {% csrf_token %}
            <div class="container bg-main">
                <h1 class="header">sign in now</h1>
                <div class="inputs">
                    <input type="email" name="Email" placeholder="Enter Your Email" id="email">
                    <input type="password" name="password" placeholder="Enter Your Password" id="password">
                </div>  
                <div class="alert"></div>
                <button type="submit" class=" button btn btn-sec-main" id="btn">
                    <i class="fa-solid fa-right-to-bracket"></i> Sign In 
                </button>    
                <p>don't have an account? <a href="{% url "ChooseRole" %}">sign up</a></p>
            </div>
    </div>
    <script>
        
        let uemail =document.getElementById('email')
    let upass=document.getElementById('password')
    let btn=document.getElementById('btn')
    let alert=document.querySelector(".alert")
    let x=false;
    btn.addEventListener('click', ()=>{
        if(uemail.value && upass.value){
            loginwithServer(uemail.value,upass.value)
        }
        else{
            vaildation()
        } 
    } )

    function vaildation(){
        alert.style=`display:flex`
        alert.innerHTML=`<p>Incorrect E-mail or Password</p>`
    }

    async function loginwithServer(email,password){
        let user={
            email:email,
            password:password
        }
        let CSRFToken=document.querySelector('[name=csrfmiddlewaretoken]').value
        let res=await fetch('http://127.0.0.1:8000/api/Signin',{
            method:"POST",
            headers:{
                'content-type': 'application/json',
                'X-CSRFToken':CSRFToken
            },
            body:JSON.stringify(user)
        }).then((ress)=>ress).catch((err)=>err)
        let data = await res.json();
        if(data.MSG=='Incorrect Email or Password'){
            vaildation();
        }else{
            localStorage.setItem('user_role',JSON.stringify(data.MSG.role))
            localStorage.setItem('user_id',JSON.stringify(data.MSG.id))
            location.href="./home"
        }
    }
    </script>
</body>
</html>